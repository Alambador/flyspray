
  <table><tr><td id="taskfieldscell"><?php // small layout table ?>

  <div id="taskfields">
	 <table>
        <?php foreach ($proj->fields as $field): ?>
        <tr>
		  <th id="f{$field->id}">{$field->prefs['field_name']}</th>
		  <td headers="f{$field->id}">
            {!$field->view($task, $parents)}
          </td>
		</tr>
        <?php endforeach; ?>
		<tr>
		  <th id="state">{L('state')}</th>
		  <td headers="state">
			 <?php if ($task['is_closed']): ?>
			 {L('closed')}
			 <?php elseif ($task['closed_by']): ?>
             <strong class="reopened">{L('reopened')}</strong>
             <?php else: ?>
             {L('open')}
			 <?php endif; ?>
		  </td>
		</tr>
		<tr>
		  <th id="assignedto">{L('assignedto')}</th>
		  <td headers="assignedto">
			 <?php if (empty($assigned_users)): ?>
			 {L('noone')}
			 <?php else:
			 foreach ($assigned_users as $userid):
			 ?>
			 {!tpl_userlink($userid)}<br />
			 <?php endforeach;
			 endif; ?>
		  </td>
		</tr>
		<tr>
		  <th id="severity">{L('severity')}</th>
		  <td headers="severity">{$task['severity_name']}</td>
		</tr>
		<tr>
		  <th id="percent">{L('percentcomplete')}</th>
		  <td headers="percent" class="middle">
            <div class="taskpercent"><div style="width:{$task['percent_complete']}%"> </div></div>
		  </td>
		</tr>
        <tr class="votes">
		  <th id="votes">{L('votes')}</th>
		  <td headers="votes">
          <?php if (count($votes)): ?>
          <a href="javascript:showhidestuff('showvotes')">{count($votes)} </a>
          <div id="showvotes" class="hide">
              <ul class="reports">
              <?php foreach ($votes as $vote): ?>
                <li>{!tpl_userlink($vote)} ({formatDate($vote['date_time'])})</li>
              <?php endforeach; ?>
              </ul>
          </div>
          <?php else: ?>
          0
          <?php endif; ?>
          <?php if ($user->can_vote($task) > 0): ?>
          <a href="{$_SERVER['SCRIPT_NAME']}?do=details&amp;action=addvote&amp;task_id={$task['task_id']}">
            ({L('addvote')})</a>
          <?php elseif ($user->can_vote($task) == -2): ?>
          ({L('alreadyvotedthistask')})
          <?php elseif ($user->can_vote($task) == -3): ?>
          ({L('alreadyvotedthisday')})
          <?php endif; ?>
          </td>
        </tr>
        <tr>
		  <th id="private">{L('private')}</th>
		  <td headers="private">
            <?php if ($task['mark_private']): ?>
            {L('yes')}
            <?php else: ?>
            {L('no')}
            <?php endif; ?>

            <?php if ($user->can_change_private($task) && $task['mark_private']): ?>
            <a href="{$_SERVER['SCRIPT_NAME']}?do=details&amp;action=makepublic&amp;task_id={$task['task_id']}">
            ({L('makepublic')})</a>
            <?php elseif ($user->can_change_private($task) && !$task['mark_private']): ?>
            <a href="{$_SERVER['SCRIPT_NAME']}?do=details&amp;action=makeprivate&amp;task_id={$task['task_id']}">
               ({L('makeprivate')})</a>
            <?php endif; ?>
          </td>
        </tr>
        <?php if (!$user->isAnon()): ?>
        <tr>
		  <th id="watching">{L('watching')}</th>
		  <td headers="watching">
              <?php if ($watched): ?>
              {L('yes')}
              <?php else: ?>
              {L('no')}
              <?php endif; ?>

              <?php if (!$watched): ?>
              <a accesskey="w"
              href="{$_SERVER['SCRIPT_NAME']}?do=details&amp;task_id={$task['task_id']}&amp;action=add_notification&amp;ids={$task['task_id']}&amp;user_id={$user->id}">
              ({L('watchtask')})</a>
              <?php else: ?>
              <a accesskey="w"
              href="{$_SERVER['SCRIPT_NAME']}?do=details&amp;task_id={$task['task_id']}&amp;action=remove_notification&amp;ids={$task['task_id']}&amp;user_id={$user->id}">
              ({L('stopwatching')})</a>
              <?php endif; ?>
          </td>
        </tr>
        <?php endif; ?>
	 </table>
  </div>

  </td><td>

  <div id="taskdetailsfull">
	 <h3 class="taskdesc">{L('details')}</h3>
     <div id="taskdetailstext">{!$task_text}</div>

     <?php $attachments = $proj->listTaskAttachments($task['task_id']);
           $this->display('common.attachments.tpl', 'attachments', $attachments); ?>
  </div>

  </td></tr></table>